version: '3.8'

services:
  postgres:
    build:
      context: ./
      dockerfile: postgres/Dockerfile
    container_name: postgres1
    restart: always
    ports:
      - 5442:5432
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: ${POSTGRES_DB}
    volumes:
      - ./data/postgres1:/var/lib/postgresql/data
      - pg-config:/etc/postgresql
    entrypoint: docker-entrypoint.sh -c 'config_file=/etc/postgresql/postgresql.conf'

  pgadmin:
    image: dpage/pgadmin4
    container_name: pgAdmin
    restart: always
    ports:
      - 5050:80
    environment:
      PGADMIN_DEFAULT_EMAIL: ${PGADMIN_DEFAULT_EMAIL}
      PGADMIN_DEFAULT_PASSWORD: ${PGADMIN_DEFAULT_PASSWORD}
    volumes:
      - ./../app/data/pgadmin:/var/lib/pgadmin

volumes:
  pg-config:
    driver: local
    driver_opts:
      type: "none"
      o: "bind"
      device: "postgres"